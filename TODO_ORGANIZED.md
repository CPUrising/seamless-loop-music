# 无缝循环音乐播放器 - 开发路线图 & 任务清单

> **注**: 本文件是对 `todo.md` 中原始笔记的整理与分类。

## 1. 🚨 严重问题 (Bug 与 稳定性)

### **稳定性与性能**
- [ ] **崩溃诊断/解决**: 解决偶发崩溃和卡死问题（滋滋声 + 系统冻结）。
  - *原文*: "偶发崩溃？忽然卡住... 滋滋滋"
- [ ] **启动可靠性**: 修复频繁启动失败的问题。
  - *原文*: "经常挂掉"
- [ ] **线程安全**: 调查潜在的竞争条件或不稳定的线程问题。
  - *原文*: "时不时被打断？线程不稳定？"
- [ ] **单例模式**: 在 `App.xaml.cs` 中实现 Mutex 互斥体，防止多开。
  - *现状*: 无检查。
  - *目标*: "禁止双开"

### **音频瑕疵**
- [ ] **消除爆音**: 消除跳转或循环时的爆裂声 (Pop/Click)。
  - *出现场景*: 切换歌曲时，有时在智能匹配时也会出现。

## 2. 🧠 核心算法 & 音频引擎

### **匹配逻辑改进**
- [ ] **反向搜索优化**: 当循环起始点非常靠前 (<1s) 时的匹配优化。
  - *难点*: 像 "friend to lover" 这种歌很难找。
- [ ] **结尾处理**: 判断歌曲是否自然结束（无需循环）或需要淡出。
  - *原文*: "网易云里每首歌都有完美的结尾"
- [ ] **人声检测**: 排除人声部分的循环点候选。
- [ ] **AB 循环支持**: 支持 "前奏 (Intro) + 循环段 (Loop)" 的结构（如白色相簿风格）。

### **高级研究 (FFT / 指纹识别)**
*目标: 批量处理与“整曲指纹识别”。*

- [ ] **算法研究**:
  - **FFT 互相关**: $O(N \log N)$ - 适合长片段匹配。
  - **金字塔搜索**: $O(N)$ - 快速由粗到细搜索。
  - **过零点检测**: $O(N)$ - 速度快但精度低（部分已使用？）。
- [ ] **外部工具整合**:
  - 考虑使用 `Generic PyMusicLooper` 作为后端/处理器？
  - 读取其输出文件，同时允许 UI 手动微调。

### **格式支持**
- [ ] 深入整合 **MP3** 和 **WAV** 格式的实验。

## 3. ✨ 特性与功能

### **播放体验**
- [ ] **智能暂停**: 设备变更（如拔耳机）时自动暂停。
- [ ] **"全部播放" 模式**:
  - 循环播放所有歌曲？
  - 淡入淡出衔接 (循环末尾 -> 下一首开头+3s？)。
  - 根据标签决定歌曲是循环播放还是顺序播放。
- [ ] **列表导航**:
  - 按下“下一首”时，列表自动滚动跟随。
  - 随机播放 (Shuffle)。
- [ ] **文件夹管理**:
  - 支持添加多个文件夹。
  - UI 支持右键打开歌曲所在文件夹。

### **UI / UX 改进**
- [ ] **时间显示**: 给时间输入框增加 's' 单位或文本标签。
- [ ] **音量控制**: 重新布局音量键（移到外侧？）。
- [ ] **重命名界面**: 改进重命名 UI（目前觉得太丑）。
- [ ] **文本选择**: 启用 Label/TextBlock 的 `IsTextSelectionEnabled="True"`。
- [ ] **列表刷新**: 使用 `ObservableCollection` 优化 `ItemsSource = null` 的强制刷新写法。

## 4. 🌍 本地化 (i18n)

- [ ] **移除硬编码**: 重构 `if(lang=="cn")...` 这种逻辑。
- [ ] **实现资源文件**:
  - 使用 `.resx` 文件 (标准 WPF) 或 JSON 字典。
  - 支持 **繁体中文**。
  - 支持 **日语**。

## 5. 💾 配置与数据

- [ ] **配置整合**: 将所有配置文件移动到 `config/` 目录。
- [ ] **音量记忆**: 将音量设置保存到配置文件中。
- [ ] **数据库升级** (未来规划):
  - 现状: CSV (歌曲数量 >1000 时成为瓶颈)。
  - 建议: **SQLite** (`.db`) 或带索引的 JSON，以获得更好的扩展性。

## 6. 🌐 Web & 社区想法

- [ ] **Web 播放器?**: 理论上可以在 Web 实现无缝循环，但用户手动找点太难。
- [ ] **循环点数据库**:
  - 建立一个仓库/网站分享循环点数据。
  - 允许用户提交和 API 校验。
  - 根据游戏标题筛选歌曲？

## 7. 📥 重构与技术债

- [ ] **代码理解**: 继续“解读” AI 生成的 C# 代码 (用户主要是 C++ 背景)。
- [ ] **发布管理**: 清理发布流程和文件夹结构。

---
*由 Lev Zenith 根据 `todo.md` 整理。*
